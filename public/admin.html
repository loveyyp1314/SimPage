<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>导航后台编辑</title>
    <link rel="icon" id="site-favicon" href="/simpage-logo.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="styles.css" />
    <script type="module" src="scripts/admin.js" defer></script>
    <style>
      .input-with-button {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .input-with-button input {
        flex-grow: 1;
        min-width: 0;
      }
      .input-with-button button {
        flex-shrink: 0;
      }
    </style>
  </head>
  <body class="admin-body">
    <div class="ambient ambient-a" aria-hidden="true"></div>
    <div class="ambient ambient-b" aria-hidden="true"></div>
    <main class="layout admin-layout">
      <header class="admin-header glass">
        <div>
          <span class="badge">后台管理</span>
          <h1>导航数据编辑</h1>
          <p>管理导航页中的应用与书签数据，保存后即可在前台即时生效。</p>
        </div>
        <div class="admin-header-actions">
          <a class="admin-return" href="/">返回导航页</a>
          <button type="button" class="ghost-button" id="logout-button" disabled>退出登录</button>
        </div>
      </header>

      <section class="admin-section glass" aria-labelledby="site-settings-title">
        <div class="section-header admin-section-header">
          <div>
            <h2 id="site-settings-title">站点信息</h2>
            <p>配置导航页的名称、Logo 以及问候语。</p>
          </div>
        </div>
        <div class="settings-grid">
          <div class="field">
            <span>网站名称</span>
            <input type="text" id="site-name" autocomplete="off" placeholder="例如：SimPage 导航" />
          </div>
          <div class="field">
            <span>网站 Logo（支持 Emoji 或图片 URL）</span>
            <input type="text" id="site-logo" autocomplete="off" placeholder="例如：🚀 或 https://..." />
          </div>
          <div class="field field-span-2">
            <span>自定义问候语</span>
            <input
              type="text"
              id="site-greeting"
              autocomplete="off"
              placeholder="例如：祝你今天心情愉快！"
            />
          </div>
          <div class="field field-span-2 weather-field">
            <span>天气配置</span>
            <div class="weather-config-grid">
              <div class="field">
                <span>城市名称</span>
                <input
                  type="text"
                  id="site-weather-city"
                  autocomplete="off"
                  placeholder="例如：北京、上海、深圳"
                />
              </div>
              <div class="field">
                <span>API Key</span>
                <div class="input-with-button">
                  <input
                    type="text"
                    id="site-weather-api-key"
                    autocomplete="off"
                    placeholder="QWeather API Key"
                  />
                  <button type="button" class="ghost-button" id="weather-api-test-button">Test</button>
                </div>
              </div>
            </div>
            <p class="field-description" id="site-weather-summary">
              Provide city names and a QWeather API Key to enable live weather.
            </p>
          </div>

          <div class="field field-span-2">
            <span>页脚内容（支持 Markdown）</span>
            <textarea
              id="site-footer-content"
              rows="5"
              placeholder="例如：**SimPage** · 记录每一次启程。"
            ></textarea>
            <p class="field-description">支持标题、粗体、链接、列表等 Markdown 语法。</p>
          </div>
          <div class="field field-span-2 footer-preview-field">
            <span>预览</span>
            <div class="footer-preview" id="site-footer-preview">暂无内容</div>
          </div>
        </div>
      </section>

      <section class="admin-section glass" aria-labelledby="password-settings-title">
        <div class="section-header admin-section-header">
          <div>
            <h2 id="password-settings-title">密码管理</h2>
            <p>修改后台登录密码，确保账户安全。</p>
          </div>
        </div>
        <form class="password-form" id="password-form" autocomplete="off">
          <div class="password-grid">
            <div class="field">
              <span>当前密码</span>
              <input
                type="password"
                id="current-password"
                autocomplete="current-password"
                placeholder="请输入当前密码"
                required
              />
            </div>
            <div class="field">
              <span>新密码</span>
              <input
                type="password"
                id="new-password"
                autocomplete="new-password"
                placeholder="请输入新密码（至少 6 位）"
                required
              />
            </div>
            <div class="field">
              <span>确认新密码</span>
              <input
                type="password"
                id="confirm-password"
                autocomplete="new-password"
                placeholder="请再次输入新密码"
                required
              />
            </div>
          </div>
          <p class="password-hint">首次使用默认密码：admin123。修改密码后请妥善保存。</p>
          <p class="password-message" id="password-message" role="status" aria-live="polite" hidden></p>
          <div class="password-actions">
            <button type="submit" class="primary-button" id="password-submit">更新密码</button>
          </div>
        </form>
      </section>

      <section class="admin-section glass" aria-labelledby="apps-editor-title">
        <div class="section-header admin-section-header">
          <div>
            <h2 id="apps-editor-title">应用</h2>
            <p>常用在线应用的快捷入口。</p>
          </div>
          <button type="button" class="add-button" data-target="apps">+ 添加应用</button>
        </div>
        <div class="edit-list" id="apps-editor"></div>
      </section>

      <section class="admin-section glass" aria-labelledby="bookmarks-editor-title">
        <div class="section-header admin-section-header">
          <div>
            <h2 id="bookmarks-editor-title">书签</h2>
            <p>收藏的站点与资源链接。</p>
          </div>
          <button type="button" class="add-button" data-target="bookmarks">+ 添加书签</button>
        </div>
        <div class="edit-list" id="bookmarks-editor"></div>
      </section>

      <section class="admin-actions glass">
        <div class="status" id="status-bar" role="status">等待操作</div>
        <div class="action-buttons">
          <button type="button" class="ghost-button" id="back-to-apps-button">回到应用</button>
          <button type="button" class="ghost-button" id="back-to-bookmarks-button">回到书签</button>
          <button type="button" class="ghost-button" id="reload-button">放弃更改</button>
          <button type="button" class="primary-button" id="save-button" disabled>保存修改</button>
        </div>
      </section>
    </main>

    <button type="button" class="back-to-top" id="back-to-top" aria-label="回到顶部" hidden>
      ⌃
    </button>

    <datalist id="category-suggestions"></datalist>

    <div class="modal" id="editor-modal" hidden aria-hidden="true">
      <div class="modal-overlay" id="editor-modal-overlay" aria-hidden="true"></div>
      <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="editor-modal-title">
        <form class="modal-form" id="editor-form">
          <header class="modal-header">
            <h2 id="editor-modal-title">编辑条目</h2>
            <button type="button" class="modal-close" id="editor-close-button" aria-label="关闭">×</button>
          </header>
          <div class="modal-body">
            <div class="field">
              <span>名称</span>
              <input type="text" id="editor-name" required autocomplete="off" placeholder="例如：Figma" />
            </div>
            <div class="field">
              <span>链接</span>
              <input type="url" id="editor-url" required autocomplete="off" placeholder="https://example.com" />
            </div>
            <div class="field">
              <span>描述</span>
              <textarea
                id="editor-description"
                rows="3"
                placeholder="简要说明该条目的用途"
              ></textarea>
            </div>
            <div class="field">
              <span>图标（支持 Emoji 或图片 URL）</span>
              <div class="input-with-button">
                <input type="text" id="editor-icon" autocomplete="off" placeholder="例如：🎯 或 https://..." />
                <button type="button" id="fetch-logo-button" class="secondary-button" title="根据上方填写的链接自动获取图标">自动获取</button>
              </div>
            </div>
            <div class="field" id="editor-category-field" hidden>
              <span>子分类</span>
              <input
                type="text"
                id="editor-category"
                list="category-suggestions"
                autocomplete="off"
                placeholder="例如：效率工具"
              />
            </div>
            <p class="modal-error" id="editor-error" role="alert"></p>
          </div>
          <footer class="modal-footer">
            <button type="button" class="ghost-button" id="editor-cancel-button">取消</button>
            <button type="submit" class="primary-button">保存</button>
          </footer>
        </form>
      </div>
    </div>

    <div class="auth-overlay" id="auth-overlay">
      <form class="auth-card glass" id="login-form" aria-labelledby="login-title">
        <h2 id="login-title">后台登录</h2>
        <p class="auth-description">请输入后台密码以继续。</p>
        <p class="form-error" id="login-error" role="alert" hidden></p>
        <div class="field">
          <span>密码</span>
          <input
            type="password"
            id="login-password"
            autocomplete="current-password"
            placeholder="请输入后台密码"
            required
          />
        </div>
        <button type="submit" class="primary-button">登录</button>
        <p class="auth-hint">首次使用默认密码：admin123</p>
      </form>
    </div>
  </body>
</html>
